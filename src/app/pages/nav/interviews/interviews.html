<mat-card appearance="filled">
    <mat-card-header>
        <mat-card-title>Bishopric Interviews</mat-card-title>
    </mat-card-header>
    <mat-card-content>
        <form [formGroup]="interviewForm" class="interview-form">
            <mat-form-field class="full-width">
                <mat-label>Name</mat-label>
                <input matInput formControlName="name" placeholder="Ex. John Doe">
                @if (interviewForm.controls.name.hasError('required')) {
                <mat-error>Name is required</mat-error>
                }
            </mat-form-field>

            <mat-form-field class="full-width" subscriptSizing="dynamic">
                <mat-label>Interview Type</mat-label>
                <mat-select formControlName="interviewType">
                    @for(option of interviewOptions(); track option.id) {
                    <mat-option [value]="option.id">{{option.name}}</mat-option>
                    }
                </mat-select>
                <mat-hint>{{selectedAppointmentType()?.description}}</mat-hint>
                @if (interviewForm.controls.interviewType.hasError('required')) {
                <mat-error>You must select an interview type</mat-error>
                }
            </mat-form-field>

            @if (showDescriptionBox()) {
            <mat-form-field class="full-width" subscriptSizing="dynamic">
                <mat-label>Description</mat-label>
                <textarea matInput formControlName="description" placeholder="Ex. I want to work in the temple"></textarea>
                <mat-hint>Please do not enter anything confidential</mat-hint>
            </mat-form-field>
            }
        </form>
    </mat-card-content>
</mat-card>

@defer (when selectedAppointmentType()) {
<mat-card appearance="filled">
    <mat-card-header>
        <mat-card-title>Available Times</mat-card-title>
    </mat-card-header>
    <mat-card-content>
        @if (availabilityResource.isLoading()) {
        <div class="loading-spinner">
            <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
        </div>
        }
        @else {
        These are the times the bishopric is available in the next few weeks. If none of these times work for you, please contact the executive secretary.
        <form>
            <mat-selection-list #availabilityBlocksList [formControl]="timeSlotFormControl" name="slots" [multiple]="false">
                @for (block of availabilityBlocks() | keyvalue; track block.key) {
                <div mat-subheader class="sub-header">{{block.key | date: 'EEEE, MMMM d'}}</div>
                    @for (timeSlot of block.value.timeSlots; track timeSlot) {
                    <mat-list-option [value]="timeSlot" togglePosition="before">
                        <span matListItemTitle>{{timeSlot.start | date: 'h:mm'}}-{{timeSlot.end | date: 'h:mm a'}}</span>
                        <span matListItemLine>{{timeSlot.bishopricMember}}</span>
                    </mat-list-option>
                    }
                    @empty {
                        <div mat-subheader>This time block is full.</div>
                    }
                }
                @empty {
                    <div mat-subheader>The bishopric has no available time blocks. Please contact the executive secretary to schedule your interview.</div>
                }
            </mat-selection-list>
        </form>
        }
    </mat-card-content>
    @if (!availabilityResource.isLoading() && availabilityBlocks().size > 0) {
    <mat-card-actions align="end">
        <button matButton="filled" [disabled]="interviewForm.invalid || timeSlotFormControl.invalid" (click)="submit()">Schedule Interview</button>
    </mat-card-actions>
    }
</mat-card>
}